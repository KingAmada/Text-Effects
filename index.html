<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Illusion Gallery</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Base styles for all text elements in SVGs */
        .svg-text-base {
            font-size: 120px;
            font-weight: 900;
            font-family: 'Arial Black', 'Impact', sans-serif;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        /* Styles for the new Canvas effect (from your code) */
        #tilt-canvas {
            width: 100%;
            min-width: 200px;
            max-width: 500px;
            border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            margin: 0 auto; /* Center it */
            display: block;
        }
        
        .tilt-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #D1D5DB; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 md:p-8">

    <div class="w-full max-w-7xl bg-white rounded-lg shadow-xl p-6 md:p-8">
        
        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-900 mb-4">
            Printable Text Illusion Gallery
        </h1>
        <p class="text-center text-gray-600 mb-8">
            Type in the box below to see your text rendered in 13 different illusion styles.
        </p>

        <!-- Main Input Field (now controls 13 effects) -->
        <div class="mb-10 max-w-2xl mx-auto sticky top-4 z-10 bg-white/95 backdrop-blur-sm p-4 rounded-lg shadow-lg">
            <label for="text-input" class="block text-sm font-medium text-gray-700 mb-2">
                Enter your word:
            </label>
            <input type="text" 
                   id="text-input" 
                   value="SECURITY" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-2xl" 
                   oninput="updateAllText()">
        </div>

        <!-- --- Gallery Grid --- -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

            <!-- --- Effect 1: Line Illusion --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">1. Line Illusion</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-1" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-1" width="10" height="10" patternTransform="rotate(-45)" patternUnits="userSpaceOnUse">
                                <rect width="10" height="10" fill="white"/><line x1="0" y1="5" x2="10" y2="5" stroke="black" stroke-width="5"/>
                            </pattern>
                            <pattern id="pattern-2" width="10" height="10" patternTransform="rotate(45)" patternUnits="userSpaceOnUse">
                                <rect width="10" height="10" fill="white"/><line x1="0" y1="5" x2="10" y2="5" stroke="black" stroke-width="5"/>
                            </pattern>
                            <mask id="text-mask-1">
                                <rect width="800" height="400" fill="black" />
                                <!-- *** FIX: Changed x/y to 400/200 *** -->
                                <text id="svg-text-1" class="svg-text-base" x="400" y="200" fill="white">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-1)" />
                        <rect width="800" height="400" fill="url(#pattern-2)" mask="url(#text-mask-1)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-1', 'line-illusion')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 2: Guilloché Security Pattern --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">2. Guilloché Security Pattern</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-2" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-guilloche-1" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M -5 10 Q 5 0, 15 10 T 25 10" stroke="#aaa" stroke-width="1.5" fill="none"/>
                                <path d="M -5 20 Q 5 10, 15 20 T 25 20" stroke="#aaa" stroke-width="1.5" fill="none"/>
                            </pattern>
                            <pattern id="pattern-guilloche-2" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 10 -5 Q 20 5, 10 15 T 10 25" stroke="black" stroke-width="1" fill="none"/>
                                <path d="M 20 -5 Q 10 5, 20 15 T 20 25" stroke="black" stroke-width="1" fill="none"/>
                            </pattern>
                            <mask id="text-mask-2">
                                <rect width="800" height="400" fill="black" />
                                <!-- *** FIX: Changed x/y to 400/200 *** -->
                                <text id="svg-text-2" class="svg-text-base" x="400" y="200" fill="white">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-guilloche-1)" />
                        <rect width="800" height="400" fill="url(#pattern-guilloche-2)" mask="url(#text-mask-2)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-2', 'guilloche-security')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 3: Void (Negative Space) --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">3. Void (Negative Space)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-3" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-3" width="10" height="10" patternTransform="rotate(45)" patternUnits="userSpaceOnUse">
                                <rect width="10" height="10" fill="white"/><line x1="0" y1="5" x2="10" y2="5" stroke="black" stroke-width="5"/>
                            </pattern>
                            <mask id="text-mask-3">
                                <rect width="800" height="400" fill="white" />
                                <!-- *** FIX: Changed x/y to 400/200 *** -->
                                <text id="svg-text-3" class="svg-text-base" x="400" y="200" fill="black">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-3)" mask="url(#text-mask-3)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-3', 'void-negative')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 4: Embossed (Watermark) --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">4. Embossed (Watermark)</h2>
                <div class="w-full bg-gray-200 border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-4" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-emboss">
                                <feDropShadow dx="1.5" dy="1.5" stdDeviation="0.5" flood-color="#000" flood-opacity="0.3"/>
                                <feDropShadow dx="-1.5" dy="-1.5" stdDeviation="0.5" flood-color="#FFF" flood-opacity="0.5"/>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="#E5E7EB" />
                        <!-- *** FIX: Changed x/y to 400/200 *** -->
                        <text id="svg-text-4" class="svg-text-base" x="400" y="200" fill="#E5E7EB" filter="url(#filter-emboss)">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-4', 'embossed')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 5: 3D Anaglyph --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">5. 3D Anaglyph</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-5" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-anaglyph">
                                <feFlood flood-color="#FF0000" result="red" />
                                <feComposite in="red" in2="SourceAlpha" operator="in" result="red-clip" />
                                <feOffset in="red-clip" dx="-3" dy="0" result="red-offset" />
                                <feFlood flood-color="#00FFFF" result="cyan" />
                                <feComposite in="cyan" in2="SourceAlpha" operator="in" result="cyan-clip" />
                                <feOffset in="cyan-clip" dx="3" dy="0" result="cyan-offset" />
                                <feMerge>
                                    <feMergeNode in="red-offset"/><feMergeNode in="cyan-offset"/><feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <!-- *** FIX: Changed x/y to 400/200 *** -->
                        <text id="svg-text-5" class="svg-text-base" x="400" y="200" fill="black" filter="url(#filter-anaglyph)">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-5', 'anaglyph-3d')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 6: Halftone (Dot Matrix) --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">6. Halftone (Dot Matrix)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-6" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-dots" width="8" height="8" patternUnits="userSpaceOnUse">
                                <circle cx="4" cy="4" r="3" fill="black" />
                            </pattern>
                            <mask id="text-mask-6">
                                <rect width="800" height="400" fill="black" />
                                <!-- *** FIX: Changed x/y to 400/200 *** -->
                                <text id="svg-text-6" class="svg-text-base" x="400" y="200" fill="white">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-dots)" mask="url(#text-mask-6)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-6', 'halftone-dots')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 7: Noise Texture --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">7. Noise Texture</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-7" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-noise">
                                <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch" result="noise" />
                                <feDiffuseLighting in="noise" lighting-color="white" surfaceScale="2" result="lit">
                                    <feDistantLight azimuth="45" elevation="60" />
                                </feDiffuseLighting>
                                <feComposite in="lit" in2="SourceGraphic" operator="in" />
                            </filter>
                            <!-- *** FIX: Changed x/y to 400/200 *** -->
                            <text id="svg-text-7" class="svg-text-base" x="400" y="200" fill="black">SECURITY</text>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <use href="#svg-text-7" filter="url(#filter-noise)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-7', 'noise-texture')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 8: Fragmented (Glitch) --- -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">8. Fragmented (Glitch)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-8" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <!-- *** FIX: Changed x/y to 400/200 *** -->
                            <text id="svg-text-8" class="svg-text-base" x="400" y="200" fill="black">SECURITY</text>
                            <clipPath id="clip-slice-1"><rect x="0" y="0" width="800" height="100"/></clipPath>
                            <clipPath id="clip-slice-2"><rect x="0" y="100" width="800" height="100"/></clipPath>
                            <clipPath id="clip-slice-3"><rect x="0" y="200" width="800" height="100"/></clipPath>
                            <clipPath id="clip-slice-4"><rect x="0" y="300" width="800" height="100"/></clipPath>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <use href="#svg-text-8" clip-path="url(#clip-slice-1)" transform="translate(5, 0)"/>
                        <use href="#svg-text-8" clip-path="url(#clip-slice-2)" transform="translate(-10, 0)"/>
                        <use href="#svg-text-8" clip-path="url(#clip-slice-3)" transform="translate(10, 0)"/>
                        <use href="#svg-text-8" clip-path="url(#clip-slice-4)" transform="translate(-5, 0)"/>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-8', 'fragmented-glitch')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 9: Microtext Pattern --- -->
            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">9. Microtext Pattern (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-9" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-microtext" width="100" height="18" patternUnits="userSpaceOnUse">
                                <text x="0" y="15" font-family="Arial, sans-serif" font-weight="600" font-size="10" fill="#888">GENUINE</text>
                            </pattern>
                            <mask id="text-mask-9">
                                <rect width="800" height="400" fill="black" />
                                <!-- *** FIX: Changed x/y to 400/200 *** -->
                                <text id="svg-text-9" class="svg-text-base" x="400" y="200" fill="white">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-microtext)" mask="url(#text-mask-9)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-9', 'microtext')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 10: Engraved (Intaglio) --- -->
            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">10. Engraved (Intaglio) (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-10" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-engraved">
                                <feGaussianBlur stdDeviation="1" in="SourceAlpha" result="blur" />
                                <feSpecularLighting in="blur" surfaceScale="5" specularConstant=".75" specularExponent="20" lighting-color="#999" result="spec">
                                    <feDistantLight azimuth="225" elevation="80" />
                                </feSpecularLighting>
                                <feComposite in="spec" in2="SourceGraphic" operator="in" result="engraved" />
                                <feComposite in="SourceGraphic" in2="engraved" operator="arithmetic" k1="0" k2="1" k3="1" k4="0"/>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <!-- *** FIX: Changed x/y to 400/200 *** -->
                        <text id="svg-text-10" class="svg-text-base" x="400" y="200" fill="#555" filter="url(#filter-engraved)">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-10', 'engraved')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 11: Wavy Path (Certificate) --- -->
            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">11. Wavy Path (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-11" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <path id="wavy-path" d="M 50,200 Q 250,150 400,200 T 750,200" fill="none" stroke="none" />
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <text class="svg-text-base" fill="black">
                            <!-- This one uses textPath, so it doesn't need the x/y fix -->
                            <textPath id="svg-text-11" href="#wavy-path" startOffset="50%" text-anchor="middle" textLength="700" lengthAdjust="spacingAndGlyphs">SECURITY</textPath>
                        </text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-11', 'wavy-path')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <!-- --- Effect 12: Distortion (Displacement) --- -->
            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">12. Distortion (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-12" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-displacement">
                                <feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="1" seed="2" result="turbulence"/>
                                <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="15" xChannelSelector="R" yChannelSelector="G"/>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <!-- *** FIX: Changed x/y to 400/200 *** -->
                        <text id="svg-text-12" class="svg-text-base" x="400" y="200" fill="black" filter="url(#filter-displacement)">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-12', 'displacement')" class="download-btn">Download .PNG</button>
                </div>
            </div>
            
            <!-- --- Effect 13: Warped Checkerboard --- -->
            <div class="border border-green-200 rounded-lg p-4 shadow-sm bg-green-50">
                <h2 class="text-xl font-semibold text-green-800 mb-4">13. Warped Checkerboard</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-13" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-warp">
                                <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="3" result="noise"/>
                                <feDisplacementMap in="SourceGraphic" in2="noise" scale="50" />
                            </filter>
                            <pattern id="pattern-check" width="50" height="50" patternUnits="userSpaceOnUse">
                                <rect width="25" height="25" fill="black"/>
                                <rect x="25" y="25" width="25" height="25" fill="black"/>
                            </pattern>
                            <mask id="text-mask-13">
                                <rect width="800" height="400" fill="white" />
                                <!-- *** FIX: Changed x/y to 400/200 *** -->
                                <text id="svg-text-13" class="svg-text-base" x="400" y="200" fill="black">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-check)" filter="url(#filter-warp)" mask="url(#text-mask-13)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-13', 'warped-check')" class="download-btn">Download .PNG</button>
                </div>
            </div>
            
            <!-- --- Effect 14: Combined Tilt-to-Read (NEW) --- -->
            <div class="border border-green-200 rounded-lg p-4 shadow-sm bg-green-50">
                <h2 class="text-xl font-semibold text-green-800 mb-4">14. Combined Tilt-to-Read</h2>
                <p class="text-sm text-gray-600 -mt-3 mb-4">(This effect has its own inputs)</p>
                
                <canvas id="tilt-canvas"></canvas>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label for="hText" class="block text-sm font-medium text-gray-700 mb-1">Horizontal Text</label>
                        <input type="text" placeholder="Type horizontal text..." id="hText" class="tilt-input" value="PRINTED BY" />
                    </div>
                    <div>
                        <label for="vText" class="block text-sm font-medium text-gray-700 mb-1">Vertical Text</label>
                        <input type="text" placeholder="Type vertical text..." id="vText" class="tilt-input" value="MICRO PRESS LTD" />
                    </div>
                </div>
                <div class="text-center mt-6">
                    <button type="button" onclick="downloadTiltCanvas(this, 'tilt-canvas')" class="download-btn">Download .PNG</button>
                </div>
            </div>

        </div> <!-- End Grid -->

    </div>

    <!-- Reusable "Loading" button template -->
    <template id="loading-button-template">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-currentColor" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Generating...
    </template>
    
    <!-- Button Styles -->
    <style>
        .download-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border: 1px solid #D1D5DB; /* border-gray-300 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            font-size: 1rem; /* text-base */
            font-weight: 500; /* font-medium */
            border-radius: 0.5rem; /* rounded-lg */
            color: #374151; /* text-gray-700 */
            background-color: white;
            transition: background-color 0.15s ease-in-out;
            cursor: pointer;
        }
        .download-btn:hover {
            background-color: #F9FAFB; /* hover:bg-gray-50 */
        }
        .download-btn:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px #60A5FA, 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* focus rings */
        }
        .download-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
    </style>

    <script>
        // --- Main controller function ---
        function updateAllText() {
            const input = document.getElementById('text-input');
            const newText = input.value.toUpperCase() || ' ';
            
            // Update all 13 SVG text elements
            for (let i = 1; i <= 13; i++) {
                updateSVGText(`svg-text-${i}`, newText);
            }
        }

        // --- Refactored text scaling function for live preview ---
        function updateSVGText(textId, newText) {
            const svgText = document.getElementById(textId);
            if (!svgText) return;

            svgText.textContent = newText;

            // Special case for wavy text path
            if (textId === 'svg-text-11') {
                return; 
            }
            
            // Standard font-size scaling
            const maxTextWidth = 780; 
            const baseFontSize = 120; 
            
            svgText.setAttribute("font-size", baseFontSize + 'px');

            setTimeout(() => {
                let currentWidth = 0;
                try {
                    currentWidth = svgText.getBBox().width;
                } catch (e) { currentWidth = 0; }

                if (currentWidth > maxTextWidth) {
                    const ratio = maxTextWidth / currentWidth;
                    const newFontSize = baseFontSize * ratio;
                    svgText.setAttribute("font-size", newFontSize + 'px');
                }
            }, 0); 
        }
        
        // --- Call update on page load ---
        window.onload = () => {
            updateAllText();
            initializeTiltCanvas(); // Initialize the new canvas effect
        };
        
        
        // --- NEW SCRIPT for Tilt-to-Read Canvas ---
        
        let tiltCanvas, tiltCtx, tiltScale, tiltText;

        function initializeTiltCanvas() {
            tiltCanvas = document.getElementById('tilt-canvas');
            if (!tiltCanvas) return;
            
            tiltCtx = tiltCanvas.getContext('2d');

            tiltCanvas.width = 500;
            tiltCanvas.height = 500;
            tiltCtx.font = '25px Arial';
            tiltCtx.textAlign = 'center';
            tiltCtx.textBaseline = 'middle';

            tiltScale = {
              h: tiltCanvas.height / 20,
              v: tiltCanvas.width / 20
            };
            
            tiltText = {
              h: document.getElementById('hText').value.toUpperCase(),
              v: document.getElementById('vText').value.toUpperCase()
            };
            
            document.getElementById('hText').oninput = function() {
              tiltText.h = this.value.toUpperCase();
              updateTiltCanvas();
            };
            
            document.getElementById('vText').oninput = function() {
              tiltText.v = this.value.toUpperCase();
              updateTiltCanvas();
            };
            
            updateTiltCanvas();
        }

        function updateTiltCanvas() {
            if (!tiltCtx) return;
            
            tiltCtx.fillStyle = "#fff";
            tiltCtx.fillRect(0, 0, tiltCanvas.width, tiltCanvas.height);

            tiltCtx.fillStyle = "#000";

            // Draw horizontal text
            tiltCtx.save();
            tiltCtx.scale(1, tiltScale.h);
            tiltCtx.fillText(tiltText.h, tiltCanvas.width / 2, tiltCanvas.height / tiltScale.h / 2);
            tiltCtx.restore();

            // Draw vertical text
            tiltCtx.save();
            tiltCtx.translate(tiltCanvas.width / 2, tiltCanvas.height / 2);
            tiltCtx.rotate(Math.PI / 2);
            tiltCtx.translate(-tiltCanvas.width / 2, -tiltCanvas.width / 2); 
            tiltCtx.scale(1, tiltScale.v);
            tiltCtx.fillText(tiltText.v, tiltCanvas.width / 2, tiltCanvas.height / tiltScale.v / 2);
            tiltCtx.restore();
        }
        
        function downloadTiltCanvas(button, canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const originalButtonHTML = button.innerHTML;
            const loadingTemplate = document.getElementById('loading-button-template');
            button.innerHTML = loadingTemplate.innerHTML;
            button.disabled = true;

            try {
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataUrl;
                
                const h = document.getElementById('hText').value || 'tilt-h';
                const v = document.getElementById('vText').value || 'tilt-v';
                const filename = `tilt-read-${h.toLowerCase().replace(/\s+/g, '-')}-${v.toLowerCase().replace(/\s+/g, '-')}.png`;
                link.download = filename;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (err) {
                console.error("Error downloading canvas:", err);
            }
            
            button.innerHTML = originalButtonHTML;
            button.disabled = false;
        }

        // --- Refactored, reusable download function for SVGs ---
        // *** This is the reverted, simpler, and correct version ***
        function downloadPNG(button, svgId, filenameBase) {
            const svg = document.getElementById(svgId);
            if (!svg) return;
            
            // Store original HTML to restore it later
            button.originalHTML = button.innerHTML; 
            const loadingTemplate = document.getElementById('loading-button-template');
            button.innerHTML = loadingTemplate.innerHTML;
            button.disabled = true;

            const canvasWidth = 1600;
            const canvasHeight = 800;

            const svgData = new XMLSerializer().serializeToString(svg);
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);

            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                const ctx = canvas.getContext('2d');

                // Draw the SVG to the canvas. The absolute x/y in the SVG
                // will now be respected relative to the viewBox.
                ctx.drawImage(img, 0, 0, canvasWidth, canvasHeight);

                // Finalize the download
                finalizeDownload(canvas, button, filenameBase);
                URL.revokeObjectURL(url);
            };
            
            img.onerror = function(err) {
                console.error("Error loading SVG into image.", err);
                button.innerHTML = button.originalHTML;
                button.disabled = false;
                URL.revokeObjectURL(url);
            }
            
            img.src = url;
        }

        function finalizeDownload(canvas, button, filenameBase) {
            const pngDataUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = pngDataUrl;
            
            const inputText = document.getElementById('text-input').value || 'illusion';
            const filename = `${filenameBase}-${inputText.toLowerCase().replace(/\s+/g, '-')}.png`;
            link.download = filename;

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Restore button
            button.innerHTML = button.originalHTML; // Use stored original HTML
            button.disabled = false;
        }
    </script>

</body>
</html>


